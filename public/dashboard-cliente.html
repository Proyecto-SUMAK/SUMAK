<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explora Negocios - SUMAK</title>
     
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/SumakLogo_.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/SumakLogo_.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/SumakLogo_.png">
    <link rel="shortcut icon" href="assets/images/SumakLogo_.png">
    
    <link rel="stylesheet" href="assets/styles/variables.css">
    <link rel="stylesheet" href="assets/styles/style.css">
    <link rel="stylesheet" href="assets/styles/responsive.css">
    <style>
        /* Estilos del dashboard cliente */
        .dashboard {
            display: grid;
            grid-template-columns: 250px 1fr;
            min-height: 100vh;
            background-color: var(--color-background);
        }

        .sidebar {
            background-color: var(--color-surface);
            padding: var(--spacing-lg);
            border-right: 1px solid var(--color-border);
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar__header {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--color-border);
        }

        .sidebar__logo {
            width: 40px;
            height: 40px;
        }

        .sidebar__brand {
            font-family: var(--font-family-primary);
            font-size: 1.5rem;
            font-weight: var(--font-weight-black);
            color: var(--color-primary);
        }

        .sidebar__nav {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .sidebar__link {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm);
            color: var(--color-text-secondary);
            border-radius: var(--border-radius-md);
            transition: all var(--transition-fast);
        }

        .sidebar__link:hover,
        .sidebar__link--active {
            background-color: var(--color-primary-lightest);
            color: var(--color-primary);
        }

        .sidebar__link svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .main-content {
            padding: var(--spacing-xl);
            overflow-y: auto;
        }

        .dashboard-header {
            margin-bottom: var(--spacing-xl);
        }

        .dashboard-header__top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }

        .dashboard-header__title {
            font-size: 2rem;
            margin-bottom: 0.25rem;
        }

        .dashboard-header__subtitle {
            color: var(--color-text-secondary);
        }

        .dashboard-header__actions {
            display: flex;
            gap: var(--spacing-sm);
            align-items: center;
        }

        .user-menu {
            position: relative;
        }

        .user-menu__toggle {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: 0.5rem 1rem;
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius-full);
            cursor: pointer;
        }

        .user-menu__avatar {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background-color: var(--color-secondary);
            color: white;
            font-weight: var(--font-weight-semibold);
            border-radius: var(--border-radius-full);
        }

        .user-menu__dropdown {
            display: none;
            position: absolute;
            top: calc(100% + 0.5rem);
            right: 0;
            min-width: 200px;
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-lg);
            z-index: var(--z-index-dropdown);
        }

        .user-menu__dropdown.is-open {
            display: block;
        }

        .user-menu__item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            color: var(--color-text-primary);
            transition: background-color var(--transition-fast);
        }

        .user-menu__item:hover {
            background-color: var(--color-background);
        }

        .user-menu__item--danger {
            color: var(--color-error);
        }

        /* B√∫squeda */
        .search-section {
            margin-bottom: var(--spacing-xl);
        }

        .search-bar {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
        }

        .search-bar__input {
            flex: 1;
            padding: 0.875rem 1rem;
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-md);
            font-size: var(--font-size-body);
            transition: all var(--transition-fast);
        }

        .search-bar__input:focus {
            outline: none;
            border-color: var(--color-secondary);
            box-shadow: 0 0 0 3px rgba(30, 150, 240, 0.1);
        }

        .search-filters {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .filter-chip {
            padding: 0.5rem 1rem;
            background-color: var(--color-surface);
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-full);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: var(--font-size-small);
            font-weight: var(--font-weight-medium);
        }

        .filter-chip:hover,
        .filter-chip.active {
            background-color: var(--color-secondary);
            color: white;
            border-color: var(--color-secondary);
        }

        /* Tarjetas de negocio */
        .businesses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-lg);
        }

        .business-card {
            background-color: var(--color-surface);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-normal);
            cursor: pointer;
        }

        .business-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
        }

        .business-card__image {
            position: relative;
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
        }

        .business-card__badge {
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-sm);
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.375rem 0.75rem;
            background-color: var(--color-primary);
            color: white;
            font-size: var(--font-size-small);
            font-weight: var(--font-weight-semibold);
            border-radius: var(--border-radius-full);
            box-shadow: var(--shadow-md);
        }

        .business-card__favorite {
            position: absolute;
            top: var(--spacing-sm);
            left: var(--spacing-sm);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: white;
            border: none;
            border-radius: var(--border-radius-full);
            cursor: pointer;
            transition: all var(--transition-fast);
            box-shadow: var(--shadow-md);
        }

        .business-card__favorite:hover {
            transform: scale(1.1);
        }

        .business-card__favorite.active {
            color: var(--color-error);
        }

        .business-card__content {
            padding: var(--spacing-md);
        }

        .business-card__name {
            font-size: 1.125rem;
            font-weight: var(--font-weight-semibold);
            margin-bottom: 0.25rem;
        }

        .business-card__category {
            display: inline-block;
            font-size: var(--font-size-small);
            color: var(--color-text-tertiary);
            margin-bottom: var(--spacing-sm);
        }

        .business-card__rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-size-small);
        }

        .business-card__stars {
            color: #FFA000;
        }

        .business-card__info {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-md);
            font-size: var(--font-size-small);
            color: var(--color-text-secondary);
        }

        .business-card__info-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .business-card__actions {
            display: flex;
            gap: var(--spacing-xs);
        }

        /* ========================================
           ESTILOS NUEVOS SPRINT 2
           ======================================== */

        /* US-029/US-030: Perfil detallado del negocio */
        .business-detail {
            display: none;
        }

        .business-detail.active {
            display: block;
        }

        .business-detail__header {
            position: relative;
            height: 250px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: var(--border-radius-lg);
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: flex-end;
            padding: var(--spacing-lg);
        }

        .business-detail__info {
            color: white;
        }

        .business-detail__name {
            font-size: 2rem;
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--spacing-xs);
        }

        .business-detail__badges {
            display: flex;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-sm);
        }

        .trust-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.375rem 0.75rem;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: var(--font-size-small);
            font-weight: var(--font-weight-semibold);
            border-radius: var(--border-radius-full);
            backdrop-filter: blur(4px);
        }

        .business-detail__content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--spacing-xl);
        }

        .business-detail__main {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .business-detail__sidebar {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .detail-section {
            padding: var(--spacing-lg);
            background-color: var(--color-surface);
            border-radius: var(--border-radius-lg);
        }

        .detail-section__title {
            font-size: 1.25rem;
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* US-038: Historia del emprendedor */
        .entrepreneur-story {
            padding: var(--spacing-lg);
            background: linear-gradient(135deg, var(--color-primary-lightest) 0%, var(--color-surface) 100%);
            border-radius: var(--border-radius-lg);
            border-left: 4px solid var(--color-primary);
        }

        .entrepreneur-story__quote {
            font-style: italic;
            color: var(--color-text-secondary);
            margin-bottom: var(--spacing-md);
            line-height: 1.6;
        }

        .entrepreneur-story__author {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .entrepreneur-story__avatar {
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--color-primary);
            color: white;
            font-weight: var(--font-weight-bold);
            border-radius: var(--border-radius-full);
        }

        /* US-041: Cat√°logo visual */
        .catalog-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: var(--spacing-md);
        }

        .catalog-item {
            background-color: var(--color-surface);
            border-radius: var(--border-radius-md);
            overflow: hidden;
            transition: all var(--transition-fast);
            cursor: pointer;
        }

        .catalog-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .catalog-item__image {
            width: 100%;
            height: 120px;
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .catalog-item__content {
            padding: var(--spacing-sm);
        }

        .catalog-item__name {
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-small);
            margin-bottom: 0.25rem;
        }

        .catalog-item__price {
            color: var(--color-primary);
            font-weight: var(--font-weight-bold);
        }

        /* US-032: Compartir perfil */
        .share-actions {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }

        .share-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background-color: var(--color-background);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-size: var(--font-size-small);
            transition: all var(--transition-fast);
        }

        .share-btn:hover {
            background-color: var(--color-primary-lightest);
            border-color: var(--color-primary);
        }

        /* US-043: Reservar cita */
        .booking-section {
            padding: var(--spacing-lg);
            background-color: var(--color-surface);
            border-radius: var(--border-radius-lg);
        }

        .booking-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: var(--spacing-md);
        }

        .booking-day-header {
            text-align: center;
            font-size: var(--font-size-small);
            font-weight: var(--font-weight-semibold);
            padding: var(--spacing-xs);
        }

        .booking-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--color-background);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: var(--font-size-small);
            transition: all var(--transition-fast);
        }

        .booking-day:hover {
            background-color: var(--color-primary-lightest);
        }

        .booking-day.selected {
            background-color: var(--color-primary);
            color: white;
        }

        .booking-day.unavailable {
            background-color: var(--color-background);
            color: var(--color-text-tertiary);
            cursor: not-allowed;
        }

        .booking-times {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
        }

        .booking-time {
            padding: 0.5rem 1rem;
            background-color: var(--color-background);
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-size: var(--font-size-small);
            transition: all var(--transition-fast);
        }

        .booking-time:hover {
            border-color: var(--color-primary);
        }

        .booking-time.selected {
            background-color: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        /* US-031: Favoritos */
        .favorites-section {
            margin-bottom: var(--spacing-xl);
        }

        .favorites-empty {
            text-align: center;
            padding: var(--spacing-2xl);
            background-color: var(--color-surface);
            border-radius: var(--border-radius-lg);
        }

        /* US-033: Soporte */
        .help-section {
            padding: var(--spacing-lg);
            background-color: var(--color-surface);
            border-radius: var(--border-radius-lg);
            margin-bottom: var(--spacing-xl);
        }

        .faq-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .faq-item {
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius-md);
            overflow: hidden;
        }

        .faq-item__question {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md);
            background-color: var(--color-background);
            cursor: pointer;
            font-weight: var(--font-weight-medium);
        }

        .faq-item__answer {
            display: none;
            padding: var(--spacing-md);
            color: var(--color-text-secondary);
        }

        .faq-item.open .faq-item__answer {
            display: block;
        }

        /* US-035: Perfil del usuario */
        .user-profile-section {
            padding: var(--spacing-lg);
            background-color: var(--color-surface);
            border-radius: var(--border-radius-lg);
        }

        .profile-form {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .form__group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .form__label {
            font-weight: var(--font-weight-medium);
        }

        .form__input {
            padding: var(--spacing-sm);
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-md);
            font-family: inherit;
            transition: border-color var(--transition-fast);
        }

        .form__input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        /* Tabs */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: var(--z-index-modal);
            align-items: center;
            justify-content: center;
        }

        .modal.modal--active {
            display: flex;
        }

        .modal__overlay {
            position: absolute;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal__container {
            position: relative;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            background-color: var(--color-surface);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
        }

        .modal__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--color-border);
        }

        .modal__title {
            font-size: 1.25rem;
            font-weight: var(--font-weight-semibold);
        }

        .modal__close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--color-text-tertiary);
        }

        .modal__body {
            padding: var(--spacing-lg);
            overflow-y: auto;
            max-height: calc(90vh - 140px);
        }

        .modal__footer {
            padding: var(--spacing-lg);
            border-top: 1px solid var(--color-border);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-sm);
        }

        @media (max-width: 767px) {
            .dashboard {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: none;
            }

            .main-content {
                padding: var(--spacing-md);
            }

            .dashboard-header__top {
                flex-direction: column;
                gap: var(--spacing-md);
                align-items: flex-start;
            }

            .search-bar {
                flex-direction: column;
            }

            .businesses-grid {
                grid-template-columns: 1fr;
            }

            .business-detail__content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- 
        DASHBOARD DEL CLIENTE - SPRINT 2
        US-029: Ver informaci√≥n detallada del negocio
        US-030: Ver la confiabilidad del negocio
        US-031: Guardar emprendedores favoritos
        US-032: Recomendar un emprendedor a un amigo
        US-033: Soporte t√©cnico integrado
        US-034: Notificaciones relevantes
        US-035: Perfil del usuario
        US-038: Conocer la historia del emprendedor
        US-041: Ver cat√°logo visual del negocio
        US-042: Comparar negocios en tarjetas
        US-043: Reservar cita en calendario visual
        US-044: Filtrar negocios con men√∫ visual
    -->
    <div class="dashboard">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar__header">
                <img src="assets/images/SumakLogo_.png" alt="SUMAK" class="sidebar__logo">
                <span class="sidebar__brand">SUMAK</span>
            </div>

            <nav class="sidebar__nav">
                <a href="#" class="sidebar__link sidebar__link--active" data-tab="explorar">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <path d="M21 21l-4.35-4.35"/>
                    </svg>
                    <span>Explorar</span>
                </a>
                <a href="#" class="sidebar__link" data-tab="favoritos">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/>
                    </svg>
                    <span>Mis Favoritos</span>
                </a>
                <a href="#" class="sidebar__link" data-tab="reservas">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    <span>Mis Reservas</span>
                </a>
                <a href="#" class="sidebar__link" data-tab="resenas">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                    <span>Mis Rese√±as</span>
                </a>
                <a href="#" class="sidebar__link" data-tab="ayuda">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/>
                        <line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                    <span>Ayuda</span>
                </a>
                <a href="#" class="sidebar__link" data-tab="perfil">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="8" r="5"/>
                        <path d="M20 21a8 8 0 10-16 0"/>
                    </svg>
                    <span>Mi Perfil</span>
                </a>
            </nav>
        </aside>

        <!-- Contenido Principal -->
        <main class="main-content">
            <!-- Header -->
            <header class="dashboard-header">
                <div class="dashboard-header__top">
                    <div>
                        <h1 class="dashboard-header__title" id="page-title">
                            Descubre Negocios Locales üõçÔ∏è
                        </h1>
                        <p class="dashboard-header__subtitle" id="page-subtitle">
                            Apoya a microemprendedores certificados en tu zona
                        </p>
                    </div>

                    <div class="dashboard-header__actions">
                        <div class="user-menu">
                            <button class="user-menu__toggle" id="user-menu-toggle">
                                <div class="user-menu__avatar" data-user-avatar>C</div>
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"/>
                                </svg>
                            </button>

                            <div class="user-menu__dropdown" id="user-menu">
                                <a href="#" class="user-menu__item" data-tab="perfil">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="8" r="5"/>
                                        <path d="M20 21a8 8 0 10-16 0"/>
                                    </svg>
                                    <span>Mi Perfil</span>
                                </a>
                                <a href="#" class="user-menu__item" data-tab="favoritos">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/>
                                    </svg>
                                    <span>Mis Favoritos</span>
                                </a>
                                <a href="#" class="user-menu__item" id="config-btn">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="3"/>
                                        <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
                                    </svg>
                                    <span>Configuraci√≥n</span>
                                </a>
                                <a href="#" class="user-menu__item user-menu__item--danger" id="logout-btn">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
                                        <polyline points="16 17 21 12 16 7"/>
                                        <line x1="21" y1="12" x2="9" y2="12"/>
                                    </svg>
                                    <span>Cerrar Sesi√≥n</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- TAB: EXPLORAR -->
            <div class="tab-content active" id="tab-explorar">
                <!-- B√∫squeda (US-044) -->
                <section class="search-section">
                    <div class="search-bar">
                        <input type="text" class="search-bar__input" id="search-input" placeholder="Buscar negocios, productos o servicios...">
                        <button class="btn btn--primary" onclick="searchBusinesses()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"/>
                                <path d="M21 21l-4.35-4.35"/>
                            </svg>
                            Buscar
                        </button>
                    </div>

                    <div class="search-filters">
                        <button class="filter-chip active" data-category="all">üè™ Todos</button>
                        <button class="filter-chip" data-category="comida">üçΩÔ∏è Comida</button>
                        <button class="filter-chip" data-category="ropa">üëï Ropa</button>
                        <button class="filter-chip" data-category="belleza">üíÑ Belleza</button>
                        <button class="filter-chip" data-category="tecnologia">üíª Tecnolog√≠a</button>
                        <button class="filter-chip" data-category="artesania">üé® Artesan√≠a</button>
                        <button class="filter-chip" data-category="servicios">üîß Servicios</button>
                    </div>
                </section>

                <!-- Negocios (US-042) -->
                <div class="businesses-grid" id="businesses-grid">
                    <!-- Los negocios se cargar√°n din√°micamente -->
                </div>
            </div>

            <!-- TAB: FAVORITOS (US-031) -->
            <div class="tab-content" id="tab-favoritos">
                <section class="favorites-section">
                    <div class="section-header" style="margin-bottom: var(--spacing-lg);">
                        <h2>Mis Negocios Favoritos</h2>
                    </div>
                    <div class="businesses-grid" id="favorites-grid">
                        <!-- Los favoritos se cargar√°n din√°micamente -->
                    </div>
                </section>
            </div>

            <!-- TAB: RESERVAS (US-043) -->
            <div class="tab-content" id="tab-reservas">
                <section>
                    <div class="section-header" style="margin-bottom: var(--spacing-lg);">
                        <h2>Mis Reservas</h2>
                    </div>
                    <div id="reservations-list">
                        <!-- Las reservas se cargar√°n din√°micamente -->
                    </div>
                </section>
            </div>

            <!-- TAB: RESE√ëAS -->
            <div class="tab-content" id="tab-resenas">
                <section>
                    <div class="section-header" style="margin-bottom: var(--spacing-lg);">
                        <h2>Mis Rese√±as</h2>
                    </div>
                    <div id="reviews-list">
                        <!-- Las rese√±as se cargar√°n din√°micamente -->
                    </div>
                </section>
            </div>

            <!-- TAB: AYUDA (US-033) -->
            <div class="tab-content" id="tab-ayuda">
                <section class="help-section">
                    <h2 style="margin-bottom: var(--spacing-lg);">Centro de Ayuda</h2>
                    
                    <h3 style="margin-bottom: var(--spacing-md);">Preguntas Frecuentes</h3>
                    <div class="faq-list" id="faq-list">
                        <!-- Las FAQs se cargar√°n din√°micamente -->
                    </div>

                    <div style="margin-top: var(--spacing-xl); padding: var(--spacing-lg); background-color: var(--color-background); border-radius: var(--border-radius-lg); text-align: center;">
                        <h3 style="margin-bottom: var(--spacing-sm);">¬øNo encontraste lo que buscabas?</h3>
                        <p style="color: var(--color-text-secondary); margin-bottom: var(--spacing-md);">
                            Env√≠anos un comentario y te responderemos pronto
                        </p>
                        <button class="btn btn--primary" id="contact-support-btn">
                            üìß Contactar Soporte
                        </button>
                    </div>
                </section>
            </div>

            <!-- TAB: PERFIL (US-035) -->
            <div class="tab-content" id="tab-perfil">
                <section class="user-profile-section">
                    <h2 style="margin-bottom: var(--spacing-lg);">Mi Perfil</h2>
                    
                    <form class="profile-form" id="profile-form">
                        <div class="form__group">
                            <label class="form__label">Nombre completo</label>
                            <input type="text" class="form__input" id="profile-name" value="Cliente SUMAK">
                        </div>
                        <div class="form__group">
                            <label class="form__label">Correo electr√≥nico</label>
                            <input type="email" class="form__input" id="profile-email" value="cliente@ejemplo.com">
                        </div>
                        <div class="form__group">
                            <label class="form__label">Tel√©fono</label>
                            <input type="tel" class="form__input" id="profile-phone" value="999 888 777">
                        </div>
                        <div class="form__group">
                            <label class="form__label">Ubicaci√≥n</label>
                            <input type="text" class="form__input" id="profile-location" value="Lima, Per√∫">
                        </div>

                        <div style="display: flex; gap: var(--spacing-sm); margin-top: var(--spacing-md);">
                            <button type="submit" class="btn btn--primary">Guardar cambios</button>
                            <button type="button" class="btn btn--outline" style="color: var(--color-error);" id="delete-account-btn">
                                Eliminar cuenta
                            </button>
                        </div>
                    </form>
                </section>
            </div>

            <!-- DETALLE DE NEGOCIO (US-029, US-030, US-038, US-041) -->
            <div class="tab-content" id="tab-business-detail">
                <button class="btn btn--outline" style="margin-bottom: var(--spacing-md);" onclick="goBackToExplore()">
                    ‚Üê Volver a explorar
                </button>

                <div class="business-detail__header" id="detail-header">
                    <div class="business-detail__info">
                        <h1 class="business-detail__name" id="detail-name">Nombre del Negocio</h1>
                        <p id="detail-category">Categor√≠a</p>
                        <div class="business-detail__badges" id="detail-badges">
                            <!-- Badges de confianza -->
                        </div>
                    </div>
                </div>

                <div class="business-detail__content">
                    <div class="business-detail__main">
                        <!-- Historia del emprendedor (US-038) -->
                        <div class="entrepreneur-story">
                            <h3 style="margin-bottom: var(--spacing-md);">üìñ Conoce su historia</h3>
                            <p class="entrepreneur-story__quote" id="detail-story">
                                "Cargando historia del emprendedor..."
                            </p>
                            <div class="entrepreneur-story__author">
                                <div class="entrepreneur-story__avatar" id="detail-avatar">ML</div>
                                <div>
                                    <strong id="detail-owner">Nombre del due√±o</strong>
                                    <p style="font-size: var(--font-size-small); color: var(--color-text-tertiary);">Fundador</p>
                                </div>
                            </div>
                        </div>

                        <!-- Cat√°logo (US-041) -->
                        <div class="detail-section">
                            <h3 class="detail-section__title">üõí Cat√°logo de Productos</h3>
                            <div class="catalog-grid" id="detail-catalog">
                                <!-- Productos se cargan din√°micamente -->
                            </div>
                        </div>

                        <!-- Rese√±as -->
                        <div class="detail-section">
                            <h3 class="detail-section__title">‚≠ê Rese√±as de clientes</h3>
                            <div id="detail-reviews">
                                <!-- Rese√±as se cargan din√°micamente -->
                            </div>
                        </div>
                    </div>

                    <div class="business-detail__sidebar">
                        <!-- Acciones -->
                        <div class="detail-section">
                            <h3 class="detail-section__title">Acciones</h3>
                            <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
                                <button class="btn btn--primary" id="btn-favorite-detail">
                                    ‚ù§Ô∏è Agregar a favoritos
                                </button>
                                <button class="btn btn--outline" onclick="openShareModal()">
                                    üîó Compartir
                                </button>
                                <button class="btn btn--outline" id="btn-contact-business">
                                    üí¨ Contactar por WhatsApp
                                </button>
                            </div>
                        </div>

                        <!-- Reservar cita (US-043) -->
                        <div class="booking-section">
                            <h3 class="detail-section__title">üìÖ Reservar cita</h3>
                            <div class="booking-calendar" id="booking-calendar">
                                <!-- Calendario se genera din√°micamente -->
                            </div>
                            <h4 style="margin-bottom: var(--spacing-sm);">Horarios disponibles:</h4>
                            <div class="booking-times" id="booking-times">
                                <!-- Horarios se cargan din√°micamente -->
                            </div>
                            <button class="btn btn--primary" style="width: 100%; margin-top: var(--spacing-md);" id="confirm-booking-btn">
                                Confirmar reserva
                            </button>
                        </div>

                        <!-- Informaci√≥n de contacto -->
                        <div class="detail-section">
                            <h3 class="detail-section__title">üìç Contacto</h3>
                            <div style="display: flex; flex-direction: column; gap: var(--spacing-sm); color: var(--color-text-secondary);">
                                <p id="detail-address">üìç Direcci√≥n</p>
                                <p id="detail-phone">üìû Tel√©fono</p>
                                <p id="detail-hours">üïê Horario</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal: Compartir (US-032) -->
    <div class="modal" id="share-modal">
        <div class="modal__overlay"></div>
        <div class="modal__container">
            <div class="modal__header">
                <h2 class="modal__title">Compartir este negocio</h2>
                <button class="modal__close" onclick="closeModal('share-modal')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal__body">
                <p style="margin-bottom: var(--spacing-lg); color: var(--color-text-secondary);">
                    Recomienda este emprendedor a tus amigos y familiares
                </p>
                <div class="share-actions">
                    <button class="share-btn" onclick="shareViaWhatsApp()">
                        üí¨ WhatsApp
                    </button>
                    <button class="share-btn" onclick="shareViaEmail()">
                        üìß Correo
                    </button>
                    <button class="share-btn" onclick="shareViaFacebook()">
                        üìò Facebook
                    </button>
                    <button class="share-btn" onclick="copyLink()">
                        üîó Copiar enlace
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Contactar Soporte (US-033) -->
    <div class="modal" id="support-modal">
        <div class="modal__overlay"></div>
        <div class="modal__container">
            <div class="modal__header">
                <h2 class="modal__title">Contactar Soporte</h2>
                <button class="modal__close" onclick="closeModal('support-modal')">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal__body">
                <form id="support-form">
                    <div class="form__group">
                        <label class="form__label">Tipo de consulta</label>
                        <select class="form__input">
                            <option value="">Selecciona una opci√≥n</option>
                            <option value="problema">Problema t√©cnico</option>
                            <option value="sugerencia">Sugerencia</option>
                            <option value="queja">Queja</option>
                            <option value="otro">Otro</option>
                        </select>
                    </div>
                    <div class="form__group">
                        <label class="form__label">Mensaje</label>
                        <textarea class="form__input" rows="5" placeholder="Describe tu consulta..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal__footer">
                <button class="btn btn--outline" onclick="closeModal('support-modal')">Cancelar</button>
                <button class="btn btn--primary" onclick="sendSupportMessage()">Enviar</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/scripts/utils.js"></script>
    <script src="assets/scripts/dashboard.js"></script>
    <script>
        // ========================================
        // FUNCIONALIDADES SPRINT 2 - CLIENTE
        // ========================================

        let favoriteBusinesses = JSON.parse(localStorage.getItem('favorite_businesses') || '[]');
        let currentBusinessId = null;

        document.addEventListener('DOMContentLoaded', () => {
            initTabs();
            initSidebarNavigation();
            loadBusinesses();
            initFilters();
            loadFAQs();
            loadBookingCalendar();
        });

        // ========================================
        // NAVEGACI√ìN
        // ========================================

        function initTabs() {
            const tabLinks = document.querySelectorAll('[data-tab]');
            tabLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabId = link.dataset.tab;
                    switchTab(tabId);
                    updatePageTitle(tabId);
                });
            });
        }

        function initSidebarNavigation() {
            const sidebarLinks = document.querySelectorAll('.sidebar__link[data-tab]');
            sidebarLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabId = link.dataset.tab;
                    sidebarLinks.forEach(l => l.classList.remove('sidebar__link--active'));
                    link.classList.add('sidebar__link--active');
                    switchTab(tabId);
                    updatePageTitle(tabId);
                });
            });
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            const targetTab = document.getElementById('tab-' + tabId);
            if (targetTab) {
                targetTab.classList.add('active');
            }
        }

        function updatePageTitle(tabId) {
            const titles = {
                'explorar': { title: 'Descubre Negocios Locales üõçÔ∏è', subtitle: 'Apoya a microemprendedores certificados en tu zona' },
                'favoritos': { title: 'Mis Favoritos ‚ù§Ô∏è', subtitle: 'Negocios que has guardado' },
                'reservas': { title: 'Mis Reservas üìÖ', subtitle: 'Gestiona tus citas programadas' },
                'resenas': { title: 'Mis Rese√±as ‚≠ê', subtitle: 'Opiniones que has dejado' },
                'ayuda': { title: 'Centro de Ayuda üÜò', subtitle: 'Resolvemos tus dudas' },
                'perfil': { title: 'Mi Perfil üë§', subtitle: 'Gestiona tu informaci√≥n personal' }
            };
            const config = titles[tabId] || titles['explorar'];
            document.getElementById('page-title').textContent = config.title;
            document.getElementById('page-subtitle').textContent = config.subtitle;
        }

        function goBackToExplore() {
            switchTab('explorar');
            updatePageTitle('explorar');
        }

        // ========================================
        // NEGOCIOS (US-042)
        // ========================================

        const businesses = [
            { id: 1, name: 'Tienda de Ropa "Mary"', category: 'ropa', rating: 4.8, reviews: 45, distance: '500m', hours: '9:00 - 18:00', phone: '999 111 222', certified: true, owner: 'Mar√≠a L√≥pez', story: 'Empec√© vendiendo ropa desde mi casa hace 5 a√±os. Gracias a SUMAK aprend√≠ a gestionar mejor mi negocio y ahora tengo mi propia tienda.' },
            { id: 2, name: 'Restaurante "El Sabor"', category: 'comida', rating: 4.5, reviews: 120, distance: '1.2km', hours: '12:00 - 22:00', phone: '999 333 444', certified: true, owner: 'Juan P√©rez', story: 'Hered√© la receta de mi abuela y decid√≠ compartirla con todos. Mi sue√±o es que todos prueben el aut√©ntico sabor de casa.' },
            { id: 3, name: 'Peluquer√≠a "Style"', category: 'belleza', rating: 4.7, reviews: 78, distance: '800m', hours: '10:00 - 20:00', phone: '999 555 666', certified: true, owner: 'Ana Garc√≠a', story: 'Comenc√© cortando el cabello a mis vecinos. Hoy tengo un sal√≥n donde cada cliente sale sinti√©ndose especial.' },
            { id: 4, name: 'Taller Mec√°nico "Ruedas"', category: 'servicios', rating: 4.3, reviews: 34, distance: '2km', hours: '8:00 - 18:00', phone: '999 777 888', certified: false, owner: 'Carlos Ruiz', story: 'Aprend√≠ de mi padre este oficio. Cada carro que arreglo es una familia que puedo ayudar.' },
            { id: 5, name: 'Pasteler√≠a "Dulce Rosa"', category: 'comida', rating: 4.9, reviews: 89, distance: '600m', hours: '7:00 - 19:00', phone: '999 999 000', certified: true, owner: 'Rosa Mart√≠nez', story: 'Mi amor por la reposter√≠a comenz√≥ horneando para mis hijos. Ahora endulzo la vida de toda la comunidad.' },
            { id: 6, name: 'Artesan√≠as del Norte', category: 'artesania', rating: 4.6, reviews: 56, distance: '1.5km', hours: '9:00 - 17:00', phone: '999 123 456', certified: true, owner: 'Pedro S√°nchez', story: 'Mis manos crean lo que mi coraz√≥n siente. Cada pieza cuenta la historia de mi pueblo.' }
        ];

        function loadBusinesses() {
            renderBusinesses(businesses);
            loadFavorites();
        }

        function renderBusinesses(businessList) {
            const grid = document.getElementById('businesses-grid');
            if (!grid) return;

            if (businessList.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: var(--spacing-2xl); color: var(--color-text-secondary);">
                        <h3>No se encontraron negocios</h3>
                        <p>Intenta con otros filtros o t√©rminos de b√∫squeda</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = businessList.map(business => `
                <article class="business-card" data-category="${business.category}" data-id="${business.id}">
                    <div class="business-card__image">
                        üè™
                        ${business.certified ? `
                            <span class="business-card__badge">
                                ‚úì Certificado SUMAK
                            </span>
                        ` : ''}
                        <button class="business-card__favorite ${favoriteBusinesses.includes(business.id) ? 'active' : ''}" 
                                onclick="toggleFavorite(event, ${business.id})">
                            ${favoriteBusinesses.includes(business.id) ? '‚ù§Ô∏è' : 'ü§ç'}
                        </button>
                    </div>
                    <div class="business-card__content">
                        <h3 class="business-card__name">${business.name}</h3>
                        <span class="business-card__category">${getCategoryName(business.category)}</span>
                        
                        <div class="business-card__rating">
                            <span class="business-card__stars">${renderStars(business.rating)}</span>
                            <span>${business.rating} (${business.reviews} rese√±as)</span>
                        </div>

                        <div class="business-card__info">
                            <div class="business-card__info-item">
                                üìç <span>${business.distance}</span>
                            </div>
                            <div class="business-card__info-item">
                                üïê <span>${business.hours}</span>
                            </div>
                        </div>

                        <div class="business-card__actions">
                            <button class="btn btn--primary btn--small" onclick="viewBusinessDetail(${business.id})">
                                Ver Detalles
                            </button>
                            <button class="btn btn--outline btn--small" onclick="contactBusiness(${business.id})">
                                üí¨ WhatsApp
                            </button>
                        </div>
                    </div>
                </article>
            `).join('');
        }

        // ========================================
        // US-044: FILTROS
        // ========================================

        function initFilters() {
            const filterChips = document.querySelectorAll('.filter-chip');
            filterChips.forEach(chip => {
                chip.addEventListener('click', () => {
                    const category = chip.dataset.category;
                    filterChips.forEach(c => c.classList.remove('active'));
                    chip.classList.add('active');

                    if (category === 'all') {
                        renderBusinesses(businesses);
                    } else {
                        const filtered = businesses.filter(b => b.category === category);
                        renderBusinesses(filtered);
                    }
                });
            });
        }

        function searchBusinesses() {
            const query = document.getElementById('search-input').value.toLowerCase().trim();
            if (!query) {
                renderBusinesses(businesses);
                return;
            }
            const filtered = businesses.filter(b => 
                b.name.toLowerCase().includes(query) ||
                b.category.toLowerCase().includes(query)
            );
            renderBusinesses(filtered);
        }

        document.getElementById('search-input')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchBusinesses();
        });

        // ========================================
        // US-029/US-030/US-038/US-041: DETALLE
        // ========================================

        function viewBusinessDetail(businessId) {
            const business = businesses.find(b => b.id === businessId);
            if (!business) return;

            currentBusinessId = businessId;

            document.getElementById('detail-name').textContent = business.name;
            document.getElementById('detail-category').textContent = getCategoryName(business.category);
            document.getElementById('detail-story').textContent = '"' + business.story + '"';
            document.getElementById('detail-owner').textContent = business.owner;
            document.getElementById('detail-avatar').textContent = getInitials(business.owner);
            document.getElementById('detail-phone').textContent = 'üìû ' + business.phone;
            document.getElementById('detail-hours').textContent = 'üïê ' + business.hours;
            document.getElementById('detail-address').textContent = 'üìç A ' + business.distance + ' de tu ubicaci√≥n';

            // Badges de confianza (US-030)
            let badgesHtml = '';
            if (business.certified) {
                badgesHtml += '<span class="trust-badge">‚úì Emprendedor Capacitado</span>';
            }
            if (business.rating >= 4.5) {
                badgesHtml += '<span class="trust-badge">‚≠ê Bien valorado</span>';
            }
            document.getElementById('detail-badges').innerHTML = badgesHtml;

            // Cat√°logo (US-041)
            const products = [
                { name: 'Producto 1', price: 'S/ 25.00' },
                { name: 'Producto 2', price: 'S/ 30.00' },
                { name: 'Producto 3', price: 'S/ 45.00' },
                { name: 'Producto 4', price: 'S/ 20.00' }
            ];
            document.getElementById('detail-catalog').innerHTML = products.map(p => `
                <div class="catalog-item">
                    <div class="catalog-item__image">üì¶</div>
                    <div class="catalog-item__content">
                        <div class="catalog-item__name">${p.name}</div>
                        <div class="catalog-item__price">${p.price}</div>
                    </div>
                </div>
            `).join('');

            // Bot√≥n favorito
            const favBtn = document.getElementById('btn-favorite-detail');
            if (favoriteBusinesses.includes(businessId)) {
                favBtn.textContent = 'üíî Quitar de favoritos';
            } else {
                favBtn.textContent = '‚ù§Ô∏è Agregar a favoritos';
            }
            favBtn.onclick = () => toggleFavoriteDetail(businessId);

            switchTab('business-detail');
        }

        // ========================================
        // US-031: FAVORITOS
        // ========================================

        function toggleFavorite(event, businessId) {
            event.stopPropagation();
            const button = event.currentTarget;
            
            if (favoriteBusinesses.includes(businessId)) {
                favoriteBusinesses = favoriteBusinesses.filter(id => id !== businessId);
                button.classList.remove('active');
                button.textContent = 'ü§ç';
                showToast('Eliminado de favoritos', 'info');
            } else {
                favoriteBusinesses.push(businessId);
                button.classList.add('active');
                button.textContent = '‚ù§Ô∏è';
                showToast('Agregado a favoritos ‚ô•', 'success');
            }
            localStorage.setItem('favorite_businesses', JSON.stringify(favoriteBusinesses));
            loadFavorites();
        }

        function toggleFavoriteDetail(businessId) {
            if (favoriteBusinesses.includes(businessId)) {
                favoriteBusinesses = favoriteBusinesses.filter(id => id !== businessId);
                document.getElementById('btn-favorite-detail').textContent = '‚ù§Ô∏è Agregar a favoritos';
                showToast('Eliminado de favoritos', 'info');
            } else {
                favoriteBusinesses.push(businessId);
                document.getElementById('btn-favorite-detail').textContent = 'üíî Quitar de favoritos';
                showToast('Agregado a favoritos ‚ô•', 'success');
            }
            localStorage.setItem('favorite_businesses', JSON.stringify(favoriteBusinesses));
            loadFavorites();
        }

        function loadFavorites() {
            const grid = document.getElementById('favorites-grid');
            if (!grid) return;

            const favBusinesses = businesses.filter(b => favoriteBusinesses.includes(b.id));
            
            if (favBusinesses.length === 0) {
                grid.innerHTML = `
                    <div class="favorites-empty" style="grid-column: 1 / -1;">
                        <h3>No tienes favoritos a√∫n</h3>
                        <p style="color: var(--color-text-secondary); margin-bottom: var(--spacing-md);">
                            Explora negocios y guarda los que m√°s te gusten
                        </p>
                        <button class="btn btn--primary" data-tab="explorar">Explorar negocios</button>
                    </div>
                `;
            } else {
                renderBusinessesToContainer(favBusinesses, grid);
            }
        }

        function renderBusinessesToContainer(businessList, container) {
            container.innerHTML = businessList.map(business => `
                <article class="business-card" data-id="${business.id}">
                    <div class="business-card__image">
                        üè™
                        ${business.certified ? '<span class="business-card__badge">‚úì Certificado</span>' : ''}
                        <button class="business-card__favorite active" onclick="toggleFavorite(event, ${business.id})">‚ù§Ô∏è</button>
                    </div>
                    <div class="business-card__content">
                        <h3 class="business-card__name">${business.name}</h3>
                        <span class="business-card__category">${getCategoryName(business.category)}</span>
                        <div class="business-card__rating">
                            <span class="business-card__stars">${renderStars(business.rating)}</span>
                            <span>${business.rating}</span>
                        </div>
                        <div class="business-card__actions">
                            <button class="btn btn--primary btn--small" onclick="viewBusinessDetail(${business.id})">Ver Detalles</button>
                        </div>
                    </div>
                </article>
            `).join('');
        }

        // ========================================
        // US-032: COMPARTIR
        // ========================================

        function openShareModal() {
            openModal('share-modal');
        }

        function shareViaWhatsApp() {
            const business = businesses.find(b => b.id === currentBusinessId);
            const text = encodeURIComponent('¬°Te recomiendo este negocio en SUMAK! ' + business?.name);
            window.open('https://wa.me/?text=' + text, '_blank');
            closeModal('share-modal');
        }

        function shareViaEmail() {
            const business = businesses.find(b => b.id === currentBusinessId);
            window.location.href = 'mailto:?subject=Te recomiendo este negocio&body=Mira este negocio en SUMAK: ' + business?.name;
            closeModal('share-modal');
        }

        function shareViaFacebook() {
            showToast('Abriendo Facebook...', 'info');
            closeModal('share-modal');
        }

        function copyLink() {
            navigator.clipboard.writeText('https://sumak.pe/negocio/' + currentBusinessId).then(() => {
                showToast('üìã Enlace copiado', 'success');
            });
            closeModal('share-modal');
        }

        // ========================================
        // US-033: AYUDA / FAQ
        // ========================================

        function loadFAQs() {
            const faqs = [
                { q: '¬øC√≥mo puedo encontrar negocios cerca de m√≠?', a: 'Usa la barra de b√∫squeda o los filtros por categor√≠a para encontrar negocios en tu zona.' },
                { q: '¬øQu√© significa el badge "Certificado SUMAK"?', a: 'Significa que el emprendedor ha completado capacitaciones en nuestra plataforma y cumple con est√°ndares de calidad.' },
                { q: '¬øC√≥mo puedo reservar una cita?', a: 'Entra al perfil del negocio y usa el calendario para seleccionar fecha y hora disponible.' },
                { q: '¬øPuedo dejar una rese√±a?', a: 'S√≠, despu√©s de visitar un negocio podr√°s dejar tu opini√≥n y calificaci√≥n.' }
            ];

            const container = document.getElementById('faq-list');
            if (!container) return;

            container.innerHTML = faqs.map((faq, index) => `
                <div class="faq-item" onclick="toggleFAQ(${index})">
                    <div class="faq-item__question">
                        <span>${faq.q}</span>
                        <span>‚ñº</span>
                    </div>
                    <div class="faq-item__answer">${faq.a}</div>
                </div>
            `).join('');
        }

        function toggleFAQ(index) {
            const items = document.querySelectorAll('.faq-item');
            items[index].classList.toggle('open');
        }

        document.getElementById('contact-support-btn')?.addEventListener('click', () => {
            openModal('support-modal');
        });

        function sendSupportMessage() {
            showToast('‚úÖ Mensaje enviado. Te responderemos pronto.', 'success');
            closeModal('support-modal');
        }

        // ========================================
        // US-043: RESERVAS
        // ========================================

        function loadBookingCalendar() {
            const calendar = document.getElementById('booking-calendar');
            const times = document.getElementById('booking-times');
            if (!calendar || !times) return;

            const days = ['D', 'L', 'M', 'M', 'J', 'V', 'S'];
            let html = days.map(d => `<div class="booking-day-header">${d}</div>`).join('');
            
            for (let i = 1; i <= 28; i++) {
                const isAvailable = Math.random() > 0.3;
                html += `<div class="booking-day ${isAvailable ? '' : 'unavailable'}" onclick="${isAvailable ? 'selectDay(' + i + ')' : ''}">${i}</div>`;
            }
            calendar.innerHTML = html;

            const availableTimes = ['9:00', '10:00', '11:00', '14:00', '15:00', '16:00'];
            times.innerHTML = availableTimes.map(t => `
                <button class="booking-time" onclick="selectTime(this)">${t}</button>
            `).join('');
        }

        function selectDay(day) {
            document.querySelectorAll('.booking-day').forEach(d => d.classList.remove('selected'));
            event.target.classList.add('selected');
        }

        function selectTime(element) {
            document.querySelectorAll('.booking-time').forEach(t => t.classList.remove('selected'));
            element.classList.add('selected');
        }

        document.getElementById('confirm-booking-btn')?.addEventListener('click', () => {
            showToast('‚úÖ Reserva confirmada. Te esperamos!', 'success');
        });

        // ========================================
        // US-035: PERFIL
        // ========================================

        document.getElementById('profile-form')?.addEventListener('submit', (e) => {
            e.preventDefault();
            showToast('‚úÖ Perfil actualizado', 'success');
        });

        document.getElementById('delete-account-btn')?.addEventListener('click', () => {
            if (confirm('¬øEst√°s seguro de que deseas eliminar tu cuenta? Esta acci√≥n no se puede deshacer.')) {
                showToast('Cuenta eliminada. Hasta pronto.', 'info');
                logout();
            }
        });

        // ========================================
        // UTILIDADES
        // ========================================

        function getCategoryName(category) {
            const categories = {
                'comida': 'üçΩÔ∏è Comida',
                'ropa': 'üëï Ropa',
                'belleza': 'üíÑ Belleza',
                'tecnologia': 'üíª Tecnolog√≠a',
                'artesania': 'üé® Artesan√≠a',
                'servicios': 'üîß Servicios'
            };
            return categories[category] || category;
        }

        function renderStars(rating) {
            return '‚≠ê'.repeat(Math.floor(rating));
        }

        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
        }

        function contactBusiness(businessId) {
            const business = businesses.find(b => b.id === businessId);
            if (business) {
                window.open('https://wa.me/51' + business.phone.replace(/\s/g, ''), '_blank');
            }
        }

        function openModal(modalId) {
            document.getElementById(modalId)?.classList.add('modal--active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId)?.classList.remove('modal--active');
            document.body.style.overflow = '';
        }

        // Cerrar modales con overlay
        document.querySelectorAll('.modal__overlay').forEach(overlay => {
            overlay.addEventListener('click', () => {
                overlay.closest('.modal').classList.remove('modal--active');
                document.body.style.overflow = '';
            });
        });

        // User menu
        document.getElementById('user-menu-toggle')?.addEventListener('click', () => {
            document.getElementById('user-menu')?.classList.toggle('is-open');
        });

        document.getElementById('logout-btn')?.addEventListener('click', (e) => {
            e.preventDefault();
            if (confirm('¬øCerrar sesi√≥n?')) {
                logout();
            }
        });
    </script>
</body>
</html>